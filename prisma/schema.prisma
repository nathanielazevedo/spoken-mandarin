generator client {
  provider     = "prisma-client-js"
  engineType   = "driverAdapters"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Lesson {
  id           String         @id @default(cuid())
  unitId       String
  order        Int
  name         String
  description  String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  unit         Unit           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  sentences    Sentence[]
  userProgress UserProgress[]
  vocabulary   Vocabulary[]

  @@unique([unitId, order])
  @@index([unitId])
}

model Level {
  id          String   @id @default(cuid())
  programId   String
  order       Int
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  program     Program  @relation(fields: [programId], references: [id], onDelete: Cascade)
  units       Unit[]

  @@unique([programId, order])
  @@index([programId])
}

model Program {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  levels      Level[]
}

model Sentence {
  id       String  @id @default(cuid())
  lessonId String
  pinyin   String
  english  String
  hanzi    String?
  audioUrl String?
  order    Int     @default(0)
  lesson   Lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Unit {
  id          String   @id @default(cuid())
  levelId     String
  order       Int
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  lessons     Lesson[]
  level       Level    @relation(fields: [levelId], references: [id], onDelete: Cascade)

  @@unique([levelId, order])
  @@index([levelId])
}

model UserProgress {
  id                String    @id @default(cuid())
  lessonId          String
  vocabularyMastery Float     @default(0)
  sentenceMastery   Float     @default(0)
  examPassed        Boolean   @default(false)
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  lesson            Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Vocabulary {
  id       String  @id @default(cuid())
  lessonId String
  pinyin   String
  english  String
  hanzi    String?
  audioUrl String?
  order    Int     @default(0)
  lesson   Lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}
