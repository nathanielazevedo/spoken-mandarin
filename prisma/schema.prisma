generator client {
  provider     = "prisma-client-js"
  engineType   = "driverAdapters"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Lesson {
  id           String         @id
  unitId       String
  order        Int
  name         String
  description  String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  Unit         Unit           @relation(fields: [unitId], references: [id], onDelete: Cascade)
  Sentence     Sentence[]
  UserProgress UserProgress[]
  Vocabulary   Vocabulary[]

  @@unique([unitId, order])
  @@index([unitId])
}

model Level {
  id          String   @id
  programId   String
  order       Int
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Program     Program  @relation(fields: [programId], references: [id], onDelete: Cascade)
  Unit        Unit[]

  @@unique([programId, order])
  @@index([programId])
}

model Program {
  id          String   @id
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Level       Level[]
}

model Sentence {
  id       String  @id
  lessonId String
  pinyin   String
  english  String
  hanzi    String?
  audioUrl String?
  order    Int     @default(0)
  Lesson   Lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Unit {
  id          String   @id
  levelId     String
  order       Int
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Lesson      Lesson[]
  Level       Level    @relation(fields: [levelId], references: [id], onDelete: Cascade)

  @@unique([levelId, order])
  @@index([levelId])
}

model UserProgress {
  id                String    @id
  lessonId          String
  vocabularyMastery Float     @default(0)
  sentenceMastery   Float     @default(0)
  examPassed        Boolean   @default(false)
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  Lesson            Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Vocabulary {
  id       String  @id
  lessonId String
  pinyin   String
  english  String
  hanzi    String?
  audioUrl String?
  order    Int     @default(0)
  Lesson   Lesson  @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}
